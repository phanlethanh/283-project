/*
 * Ebanhang.min 1.0
 * www.tinhanhsoft.com
 * Copyright 2010, TinhAnhSoft
*/
(function($){$.fn.format_number=function(options){var defaults={"min_value":1};options=$.extend(defaults,options);var value;var string_value;var a=$(this).val();$(this).live('keyup',function(e){value=$(this).val();if(e.keyCode==38){value=value.split('.').join('');value=parseInt(value);$(this).val(value+1);string_value=String($(this).val());$(this).val(addPoint(string_value))}else if(e.keyCode==40&&value>options.min_value){value=value.split('.').join('');value=parseInt(value);$(this).val(value-1);string_value=String($(this).val());$(this).val(addPoint(string_value))}else if(e.keyCode==37||e.keyCode==39){return}else{string_value=String(value);$(this).val(addPoint(string_value))}});$(this).keydown(function(e){var key=e.keyCode;var keyArray=new Array(8,9,13,46,37,39,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105);if($.inArray(key,keyArray)>-1){return true}else{return false}})}})(jQuery);function addPoint(val){var vMoney=val;vMoney=vMoney.replace(/[^\d]+/g,'');var vNewMoney="";if(vMoney.length>3){var x=1;for(var i=vMoney.length-1;i>=0;i--){vNewMoney=vNewMoney+""+vMoney[i];if(x%3==0){vNewMoney=vNewMoney+"."}x++}var tmp="";for(var i=vNewMoney.length-1;i>=0;i--){tmp=tmp+""+vNewMoney[i]}vNewMoney=tmp.replace(/^[\.]/g,'')}else{vNewMoney=vMoney}return vNewMoney}function detectBrowser(){var userAgent=navigator.userAgent;var browser={"Chrome":"Google Chrome","MSIE":"Internet Explorer","Firefox":"Firefox","Safari":"Safari","Opera":"Opera"};for(x in browser){var patt=new RegExp(x,"igm");if(patt.test(userAgent)==true){return browser[x];break}}}(function(){$.fn.dropdownview=function(options){var defaults={viewlink:'view_class',active:'active',viewitem:'resultItem',url:'getdata.php',itemid:'itemid',viewTab:1};var options=$.extend({},defaults,options);$('.'+options.viewlink).live('click',function(){var obj=$(this);var id=obj.attr('id');var slider=true;if(obj.hasClass('active')){slider=false}$('#'+options.viewitem).remove();$('.'+options.viewlink).removeClass('active');if(slider){$(obj).addClass(options.active);$(".loading").show();$.ajax({type:'POST',url:options.url,data:{itemid:id},success:function(response){$(".loading").hide();$('#'+options.itemid+id).after(response);$('.viewtab .active').removeClass('active');$('.viewtab > :nth-child('+options.viewTab+')').addClass('active');$('.content_tab').hide();var content_show=$('.viewtab > :nth-child('+options.viewTab+')').attr('name');$('#'+content_show).show()}})}})}})(jQuery);function closeModal(selector,refresh){if(refresh==false){$(selector).trigger('reveal:close')}else{$(selector).trigger('reveal:close');location.reload()}}function viewHelp(path){$("#helpModal").reveal({animation:'fade'});$("#helpModal .in-progress").css('display','block');var url=path;$(".modalHelp").css('height','500');$("#helpModal .modalHelp").load(url,function(response,status,jqXHR){if(status=='success'){$("#helpModal .in-progress").css('display','none')}});$(".close-reveal-all").click(function(){$(".modalHelp").css('height','100')})}function viewTempBill(path){$("#tempBillModal").reveal({animation:'fade'});$("#tempBillModal .in-progress").css('display','block');var url=path;$(".modalTempBill").css('max-height','500');$("#tempBillModal .modalTempBill").load(url,function(response,status,jqXHR){if(status=='success'){$("#tempBillModal .in-progress").css('display','none')}});$(".close-reveal-all").click(function(){$(".modalTempBill").css('height','100')})}function validateNumberInput(e){var key=e.keyCode;var keyArray=new Array(8,9,13,46,37,39,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105);if($.inArray(key,keyArray)>-1){return true}else{return false}}function validateFloatNumberInput(e){var key=e.keyCode;var keyArray=new Array(8,9,13,46,37,39,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105,188);if($.inArray(key,keyArray)>-1){return true}else{return false}}function IsEmail(email){var regex=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return regex.test(email)}function createConfirm(appendSelector,title,mess,idname){$(".flagConfirm").remove();var html='';var selector='confirmModal';if(idname!=false){selector='confirmModal'+idname}html+='<div id="'+selector+'" class="reveal-modalwindow medium flagConfirm">';html+='<h4>'+title+'</h4>';html+='<div class="in-progress"></div>';html+='<div class="modalContentWp">';html+='<div class="modalMess"></div>';html+='<div class="confirmBox">';html+='<div class="iconwaring"></div>';html+='<p>'+mess+'</p>';html+='<div class="clear-left"></div>';html+='</div>';html+='<div class="groupFormButton">';html+='<input type="submit" class="formButton bntsubmit" value="Ok"/>';html+='<button class="formButton cancel close-reveal-all">Cancel</button>';html+='</div>';html+='</div>';html+='<a class="close-reveal-modal close-reveal-all"></a>';html+='</div>';$(appendSelector).after(html);$('#'+selector).reveal()}function createConfirmRecord(appendSelector,title,mess,idname){$(".flagConfirm").remove();var html='';var selector='confirmModal';if(idname!=false){selector='confirmModal'+idname}html+='<div id="'+selector+'" class="reveal-modalwindow medium flagConfirm">';html+='<h4>'+title+'</h4>';html+='<div class="in-progress"></div>';html+='<div class="modalContentWp">';html+='<div class="modalMess"></div>';html+='<div class="confirmBox">';html+='<div class="iconwaring"></div>';html+='<p>'+mess+'</p>';html+='<div class="clear-left"></div>';html+='</div>';html+='<div class="groupFormButton">';html+='<input type="submit" class="formButton bntsubmit" value="Ok"/>';html+='<button class="formButton cancelModal">Cancel</button>';html+='</div>';html+='</div>';html+='<a class="close-reveal-modal close-reveal-all"></a>';html+='</div>';$(appendSelector).after(html);$('#'+selector).reveal()}function deleteItem(url,id,mess,idname){var selector='#confirmModal';if(idname!=false){selector='#confirmModal'+idname}$(".processing").show();$.ajax({type:'POST',url:url,data:{itemid:id},success:function(response){$(".processing").hide();var data=JSON.parse(response);if(data.code==500){closeModal(selector,false);$(".form-message").html('<div class="errorMess">'+data.mess+'</div>').slideDown();$(".form-message").delay(5000).slideUp()}else{closeModal(selector,false);$(".form-message").html('<div class="successMess">'+mess+'</div>').slideDown();$(".form-message").delay(4000).slideUp()}}})}function removeItem(param){var selector='#confirmModal';if(param['idname']!=false){selector='#confirmModal'+param['idname']}closeModal(selector,false);$(".processing").show();$.ajax({type:'POST',url:param['url'],data:{itemid:param['id']},success:function(response){$(".processing").hide();var data=JSON.parse(response);if(data.code==500){$(".form-message").html('<div class="errorMess">'+data.mess+'</div>').slideDown();$(".form-message").delay(5000).slideUp()}else{if(param['reload_selector']!='.bill_lists'){$(".form-message").html('<div class="successMess">'+data.mess+'</div>').slideDown();$(".form-message").delay(4000).slideUp();reloadData(param['reload_selector'],param['reload_url'])}else{reloadData2(param['reload_selector'],param['reload_url'])}}}})}function reloadData(selector,url){$(".processing").show();$.ajax({type:'POST',url:url,success:function(html){$(selector).html(html);$(".processing").hide()}})}function reloadData2(selector,url){$(".processing").show();$.ajax({type:'POST',url:url,success:function(html){location.reload()}})}function showMess(mess){$(".form-message").html('<div class="successMess">'+mess+'</div>').slideDown();$(".form-message").delay(4000).slideUp()}function showMessBackground(mess){$(".form-message-background").html('<div class="successMess">'+mess+'</div>').slideDown();$(".form-message-background").delay(4000).slideUp()}function showMessError(mess){$(".form-message").html('<div class="errorMess">'+mess+'</div>').slideDown();$(".form-message").delay(4000).slideUp()}function alertMess(title,mess){$("#alertModal").remove();var html='';html+='<div id="alertModal" class="reveal-modalwindow medium">';html+='<h4>'+title+'</h4>';html+='<div class="modalContentWp">';html+='<div class="modalMess"></div>';html+='<div class="confirmBox">';html+='<div class="iconwaring"></div>';html+='<div>'+mess+'</div>';html+='<div class="clear-left"></div>';html+='</div>';html+='<div class="groupFormButton">';html+='<input type="submit" class="formButton bntsubmit" value="Ok"/>';html+='</div>';html+='</div>';html+='<a class="close-reveal-modal close-reveal-all"></a>';html+='</div>';$("#content").after(html);$("#alertModal").reveal({animation:'fade',animationspeed:100,});$("#alertModal .bntsubmit").live('click',function(){closeModal("#alertModal",false);$("#alertModal").remove()})}function askMess(title,url,id,mess,submess,button_text){$("#askModal").remove();var html='';html+='<div id="askModal" class="reveal-modalwindow medium">';html+='<h4>'+title+'</h4>';html+='<div class="modalContentWp">';html+='<div class="modalMess"></div>';html+='<div class="confirmBox">';html+='<div class="iconwaring"></div>';html+='<div>'+mess+'</div>';html+='<div class="clear"></div>';html+='<div>'+submess+'</div>';html+='</div>';html+='<div class="groupFormButton">';html+='<input type="submit" class="formButton bntsubmit" value="'+button_text+'"/>';html+='<button class="formButton cancel close-reveal-all">Cancel</button>';html+='</div>';html+='</div>';html+='<a class="close-reveal-modal close-reveal-all"></a>';html+='</div>';$("#content").after(html);$("#askModal").reveal({animation:'fade',animationspeed:100,});$("#askModal .bntsubmit").live('click',function(){$.ajax({type:'POST',url:url,data:{itemid:id},success:function(response){closeModal("#askModal",true)}})})}function viewItem(selector,id,url){$(".loading").show();$.ajax({type:'POST',url:url,data:{itemid:id},success:function(data){$(".loading").hide();$(selector).after(data);$("#viewObj").fadeIn(300)}})}function paginationRecord(selector,page,url,applicationUrl){$(selector).html('<div style="text-align: center; padding-top: 100px;"><img src="'+applicationUrl+'/img/loading.gif" /></div>');$.ajax({type:"POST",url:url,data:"page="+page,success:function(response){$(selector).html(response)}})}function returnFilter(selector,param,id,arrChoonse){$(selector).html('<div style="text-align: center; padding-top: 100px;"><img src="'+param['full_base']+'/img/loading.gif" /></div>');$.ajax({type:'POST',url:param['url'],data:{catid:id,action:param['action'],type:param['type']},success:function(response){var obj=jQuery.parseJSON(response);var list=$(selector).html("<div id='tmp'>"+obj.list+"</div>");var element=list.clone();element.find('.itemselect').each(function(index,val){var id=parseInt($(val).attr('id'));var key='"'+id+'"';if(typeof(arrChoonse[key])=='number'&&arrChoonse[key]==1){$(val).addClass('active')}});$(selector).html(element);$('.item_paging').html(obj.paging)}})}function keyup_format_number(val){var vMoney=val;vMoney=vMoney.replace(/[^\d]+/g,'');var vNewMoney="";if(vMoney.length>3){var x=1;for(var i=vMoney.length-1;i>=0;i--){vNewMoney=vNewMoney+""+vMoney[i];if(x%3==0){vNewMoney=vNewMoney+"."}x++}var tmp="";for(var i=vNewMoney.length-1;i>=0;i--){tmp=tmp+""+vNewMoney[i]}vNewMoney=tmp.replace(/^[\.]/g,'')}else{vNewMoney=vMoney}return vNewMoney}function type_date(){$('.date-from').css('display','inline-block');$('.date-to').css('display','inline-block')}function type_month(){$('.month-from').css('display','inline-block');$('.month-to').css('display','inline-block')}function type_year(){$('.year-from').css('display','inline-block');$('.year-to').css('display','inline-block')}function type_hideall(){$('.date-from').css('display','none');$('.date-to').css('display','none');$('.month-from').css('display','none');$('.month-to').css('display','none');$('.year-from').css('display','none');$('.year-to').css('display','none')}function number_format(number,decimals,dec_point,thousands_sep){var n=number,prec=decimals;var toFixedFix=function(n,prec){var k=Math.pow(10,prec);return(Math.round(n*k)/k).toString()};n=!isFinite(+n)?0:+n;prec=!isFinite(+prec)?0:Math.abs(prec);var sep=(typeof thousands_sep==='undefined')?'.':thousands_sep;var dec=(typeof dec_point==='undefined')?'.':dec_point;var s=(prec>0)?toFixedFix(n,prec):toFixedFix(Math.round(n),prec);var abs=toFixedFix(Math.abs(n),prec);var _,i;if(abs>=1000){_=abs.split(/\D/);i=_[0].length%3||3;_[0]=s.slice(0,i+(n<0))+_[0].slice(i).replace(/(\d{3})/g,sep+'$1');s=_.join(dec)}else{s=s.replace('.',dec)}var decPos=s.indexOf(dec);if(prec>=1&&decPos!==-1&&(s.length-decPos-1)<prec){s+=new Array(prec-(s.length-decPos-1)).join(0)+'0'}else if(prec>=1&&decPos===-1){s+=dec+new Array(prec).join(0)+'0'}return s}function updateAddBillProducts(){$('#dip span.drug-no').each(function(index){$(this).text(pad2(index+1)+'.')});$('#dip .service-line').each(function(index){$(this).attr('id','li'+index)});$('#dip .del').each(function(index){$(this).attr('id','sp'+index)});$('#dip .edit_price').each(function(index){$(this).attr('id','ed'+index)});$('#dip input.product_id').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_id]')});$('#dip input.product_name').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_name]');$(this).attr('rel','li'+index)});$('#dip input.product_code').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_code]');$(this).attr('rel','li'+index)});$('#dip input.product_quantity').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_quantity]')});$('#dip input.product_price').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_price]')});$('#dip input.product_rate').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_rate]')});$('#dip input.product_tax').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_vat]')});$('#dip input.radioClass').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][unit_id]')});$('#dip .up_number').each(function(index){$(this).attr('id','span'+index)});$('#dip .down_number').each(function(index){$(this).attr('id','span'+index)})};function updateEditBillProducts(){$('#dip span.drug-no').each(function(index){$(this).text(pad2(index+1)+'.')});$('#dip .service-line').each(function(index){$(this).attr('id','li'+index)});$('#dip .del').each(function(index){$(this).attr('id','sp'+index)});$('#dip .edit_price').each(function(index){$(this).attr('id','ed'+index)});$('#dip input.product_id').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_id]')});$('#dip input.product_name').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_name]');$(this).attr('rel','li'+index)});$('#dip input.product_code').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_code]');$(this).attr('rel','li'+index)});$('#dip input.product_quantity').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_quantity]')});$('#dip input.product_price').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_price]')});$('#dip input.product_rate').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_rate]')});$('#dip input.product_tax').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][product_vat]')});$('#dip input.radioClass').each(function(index){$(this).attr('name','data[BillDetail]['+index+'][unit_id]')});$('#dip .up_number').each(function(index){$(this).attr('id','span'+index)});$('#dip .down_number').each(function(index){$(this).attr('id','span'+index)})};function updateAddImportProducts(){$('#dip span.drug-no').each(function(index){$(this).text(pad2(index+1)+'.')});$('#dip .service-line').each(function(index){$(this).attr('id','li'+index)});$('#dip .del').each(function(index){$(this).attr('id','sp'+index)});$('#dip .edit_price').each(function(index){$(this).attr('id','ed'+index)});$('#dip input.product_id').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_id]')});$('#dip input.product_name').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_name]');$(this).attr('rel','li'+index)});$('#dip input.product_code').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_code]');$(this).attr('rel','li'+index)});$('#dip input.product_quantity').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_quantity]')});$('#dip input.product_price').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_price]')});$('#dip input.product_rate').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_rate]')});$('#dip input.product_sell').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_sell]')});$('#dip .up_number').each(function(index){$(this).attr('id','span'+index)});$('#dip .down_number').each(function(index){$(this).attr('id','span'+index)})};function updateEditImportProducts(){$('#dip span.drug-no').each(function(index){$(this).text(pad2(index+1)+'.')});$('#dip .service-line').each(function(index){$(this).attr('id','li'+index)});$('#dip .del').each(function(index){$(this).attr('id','sp'+index)});$('#dip .edit_price').each(function(index){$(this).attr('id','ed'+index)});$('#dip input.product_id').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_id]')});$('#dip input.product_code').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_code]')});$('#dip input.product_name').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_name]');$(this).attr('rel','li'+index)});$('#dip input.product_quantity').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_quantity]')});$('#dip input.product_price').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_price]')});$('#dip input.product_rate').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_rate]')});$('#dip input.product_sell').each(function(index){$(this).attr('name','data[ImportDetail]['+index+'][product_sell]')});$('#dip .up_number').each(function(index){$(this).attr('id','span'+index)});$('#dip .down_number').each(function(index){$(this).attr('id','span'+index)})};function pad2(number){return(number<10?'0':'')+number}function makeInputReadonly(selector){$(selector).attr('readonly','readonly');$(selector).addClass('readonly')}$(document).ready(function(){$(".txtnumber").format_number();$(".txt_tool").click(function(){$(this).css("background","white")});$(".txt_tool").blur(function(){$(this).css("background","#EAF2FB")});var height=$(window).height()-157;$('.main_scroll').css({"height":height,"overflow":"auto"});$(window).resize(function(){var newHeight=$(window).height()-157;$('.main_scroll').css({"height":newHeight,"overflow":"auto"})});var heightDrash=$(window).height()-108;$('.drashboard_page').css({"height":heightDrash,"overflow":"auto"});$(window).resize(function(){var newHeight=$(window).height()-108;$('.drashboard_page').css({"height":newHeight,"overflow":"auto"})});var heightStatic=$(window).height()-100;$('.static_page').css({"height":heightStatic,"overflow":"auto"});$(window).resize(function(){var newHeight=$(window).height()-100;$('.static_page').css({"height":newHeight,"overflow":"auto"})});$('.viewtab .tab').live('click touchend',function(){$('.viewtab .active').removeClass('active');$(this).addClass('active');$('.content_tab').hide();var content_show=$(this).attr('name');$('#'+content_show).show()})});